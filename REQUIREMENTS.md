# アプリ詳細要件定義書（完全版）

アプリ名：まちがいパトロール

バージョン：v1.0（初期リリース）

対応プラットフォーム：
•iOS / Android（クロスプラットフォーム開発：React Native, Bare Workflowに移行済み）
•Webブラウザ対応（React Native Web, PWA形式も検討）

⸻

## 1. 📸 撮影機能

### 1.1 撮影ステップ
•「1枚目を撮影」ボタンをタップ → カメラ起動
•撮影後、確認画面で「OK」「再撮影」選択可能
•「2枚目を撮影」ボタンも同様の流れ

### 1.2 撮影仕様
•撮影解像度：端末標準に従う（最大横幅1080pxまでリサイズして処理）
•画像は内部一時メモリにのみ保持、保存は行わない
•カメラ使用時の明るさ・オートフォーカスは端末任せでOK

⸻

## 2. 🖼 画像比較対象範囲の選択

### 2.1 範囲指定方法
•撮影完了後、1枚目画像の表示エリアにてユーザーがタッチ＆ドラッグで矩形を描画
•選択後、範囲は赤枠でハイライト表示
•再タッチで再指定可能

### 2.2 範囲指定制限
•最小範囲サイズ制限あり（例：100px × 100px）
•画面端までの選択可能
•強制的な正方形でなく、自由矩形

⸻

## 3. 🎛 検出感度設定

### 3.1 スライダーUI
•ラベル：「検出感度」
•3段階設定（Low / Medium / High）または0～100スライダー
•デフォルト値：中間（50%）

### 3.2 内部処理での使い方
•感度が高いほど、差分検出のしきい値が低くなり、多くの違いを検出
•感度が低いと、より確実な差分のみを抽出

⸻

## 4. 🔍 差分調査処理

### 4.1 前処理
•アライメント（特徴点検出→射影変換）処理：
•ORB/SIFTなどの特徴点マッチングにより自動で整列
•iOS/Android版では`react-native-fast-opencv`、Web版ではOpenCV.jsを使用
•射影変換で重ね合わせ
•対象：指定範囲内の領域を切り出して使用

### 4.2 差分検出方法
•差分画像生成（絶対差分）
•差分領域のノイズ除去（モルフォロジー処理）
•ラベリングによる差分領域の抽出（矩形座標取得）

### 4.3 出力
•検出された差分領域の数と座標リスト
•座標は1枚目画像上での表示用に保持

⸻

## 5. 🎞 調査中アニメーション

### 5.1 処理中の演出
•「調査中…」の文言を中央に表示（大きめフォント）
•背景で1枚目→2枚目画像を交互に拡大ズーム表示
•アニメーション時間：片方1秒、全体で約3秒程度
•調査完了後、自動的に結果画面に遷移

⸻

## 6. ✅ 結果表示機能

### 6.1 赤枠による違いのハイライト
•1枚目画像上に赤い矩形で違いを重ねて表示
•赤枠は重複せず、周囲に5px程度の余白あり

### 6.2 アニメーション表示（オプション）
•検出された差分を1つずつフェードイン表示（0.5秒間隔）
•全体ハイライト表示後に、アニメーション開始
•「次へ／戻る」などの操作ボタンは不要（自動再生）

⸻

## 7. 📘 使い方ガイド画面

### 7.1 メニュー項目
•「使い方を見る」ボタンをホーム画面に設置

### 7.2 内容
•全5ステップ（画像と文字）
1.写真を2枚撮ろう（1枚目 → 2枚目）
2.どこを調べたいか選ぼう（指で囲むよ）
3.感度を調整しよう
4.調査ボタンを押してね
5.パトロボが間違いを見つけてくれるよ！

### 7.3 キャラクター
•ロボットキャラ「パトロボ」がガイド役
•吹き出し風のセリフで操作をナビゲート

⸻

## 8. 🛡 プライバシー・セキュリティ
•撮影画像はアプリ外に保存・送信しない
•ログイン・ユーザー情報は一切不要
•処理は可能な限りローカルで実行（サーバー処理対応設計も可）
•サーバーを使う場合は画像を送信後すぐに自動削除